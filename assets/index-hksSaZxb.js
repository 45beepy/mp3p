(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function c(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(t){if(t.ep)return;t.ep=!0;const s=c(t);fetch(t.href,s)}})();const Y="AIzaSyD53qoAMqp4Wu9nHSyaBbCzUn1j0gYK5Cw",Q="957252189604-cfmbh7s2rjbpbql8rcsrlc3bpu6m2cq5.apps.googleusercontent.com",V="https://www.googleapis.com/auth/drive.readonly",B="mp3p_music",k="https://i.pinimg.com/1200x/4a/86/34/4a86344f69940e6b166c0bcbde36c3bc.jpg",P="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";let e={token:sessionStorage.getItem("g_token"),rootId:null,albums:[],tracks:[],covers:{},trackCache:{},coverBlobCache:{},durationCache:{},albumColors:{},albumLogos:{},lyricsCache:{},syncedLyricsCache:{},playlist:[],currentIndex:-1,currentAlbum:null,playingFileId:null,playingAlbumId:null,isPlaying:!1,blobUrl:null,isLoadingTrack:!1,currentLyrics:[],currentLyricIndex:-1,currentTrackLyrics:{plain:null,synced:null},lyricsCurtainOpen:!1,searchQuery:""};const W=document.querySelector("#app");W.innerHTML=`
  <header id="main-header">
    <div class="header-left">
      <button id="back-btn" class="secondary" style="display:none;">BACK</button>
      <h1 id="page-title">MP3P</h1>
    </div>
    <div class="header-center">
      <div id="search-container" style="display:none;">
        <input type="text" id="search-input" placeholder="Search albums..." />
        <button id="clear-search">✕</button>
      </div>
    </div>
    <div class="header-right">
        <button id="search-btn" title="Search Albums">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
        <button id="auth-btn">SYNC</button>
    </div>
  </header>
  
  <div id="main-view">
    <div style="padding:50px; text-align:center; color:#666; font-weight:700;">
      TAP <span style="color:#000; background:var(--yellow); padding:2px 6px;">SYNC</span> TO LOAD LIBRARY<br><br>
      (READING FOLDER: "${B}")
    </div>
  </div>

  <div id="lyrics-curtain" class="lyrics-curtain-mini">
    <div class="lyrics-curtain-content">
      <p class="lyrics-placeholder">No track playing</p>
    </div>
  </div>

  <button class="lyrics-toggle-btn-mini" id="btn-lyrics-toggle" style="display:none;" title="Show/Hide Lyrics">
    <span class="arrow-icon-mini">››</span>
  </button>

  <div id="player-bar">
    <div class="p-art-box">
      <img id="p-art" class="p-art" src="${P}">
    </div>

    <div class="p-center">
      <div class="p-track-info">
        <span id="p-title" class="p-title">NOT PLAYING</span>
        <span id="p-artist" class="p-artist">SELECT A TRACK</span>
      </div>
      <div class="p-scrubber" id="p-scrubber">
        <div class="p-bar-bg" id="p-bar-bg">
          <div class="p-bar-fill" id="p-bar-fill"></div>
        </div>
      </div>
    </div>

    <div class="p-controls">
      <button class="ctrl-btn" id="btn-prev">⏮</button>
      <button class="ctrl-btn play-btn" id="btn-play">▶</button>
      <button class="ctrl-btn" id="btn-next">⏭</button>
    </div>
  </div>
  
  <audio id="audio-engine"></audio>
`;const q=document.getElementById("main-header"),y=document.getElementById("main-view"),S=document.getElementById("back-btn"),u=document.getElementById("page-title"),d=document.getElementById("audio-engine"),x=document.getElementById("p-title"),C=document.getElementById("p-artist"),L=document.getElementById("p-art"),h=document.getElementById("btn-play"),X=document.getElementById("btn-next"),J=document.getElementById("btn-prev"),$=document.getElementById("btn-lyrics-toggle"),Z=document.getElementById("p-scrubber"),ee=document.getElementById("p-bar-bg"),te=document.getElementById("p-bar-fill"),H=document.getElementById("lyrics-curtain"),ne=document.getElementById("search-btn"),w=document.getElementById("search-container"),T=document.getElementById("search-input"),re=document.getElementById("clear-search");L.onerror=()=>{L.src!==k&&(L.src=k)};$.onclick=()=>{e.lyricsCurtainOpen=!e.lyricsCurtainOpen,e.lyricsCurtainOpen?(H.classList.add("open"),$.classList.add("active"),K(e.currentTrackLyrics)):(H.classList.remove("open"),$.classList.remove("active"))};ne.onclick=()=>{const r=w.style.display!=="none";w.style.display=r?"none":"flex",r?(e.searchQuery="",T.value="",A()):T.focus()};T.oninput=r=>{e.searchQuery=r.target.value.toLowerCase(),A()};re.onclick=()=>{e.searchQuery="",T.value="",w.style.display="none",A()};function v(r){const n=r.replace(/\.[^/.]+$/,""),c=[/^(\d+)\.\s*/,/^(\d+)\s*-\s*/,/^(\d+)_\s*/,/^(\d+)\s+/];for(const i of c){const t=n.match(i);if(t){const s=parseInt(t[1],10),a=n.replace(i,"").trim();return{number:s,cleanName:a}}}return{number:999,cleanName:n}}function ce(r){const n=r.split(`
`),c=[];for(const i of n){const t=i.match(/^\[(\d+):(\d+)\.(\d+)\](.*)$/);if(t){const s=parseInt(t[1],10),a=parseInt(t[2],10),l=parseInt(t[3],10),o=t[4].trim(),p=s*60+a+l/100;o.length>0&&c.push({time:p,text:o})}}return c}async function F(r){if(e.albumColors[r])return e.albumColors[r];try{const n=await gapi.client.drive.files.list({q:`name = 'colors.txt' and '${r}' in parents and trashed = false`,fields:"files(id)",pageSize:1});if(!n.result.files||n.result.files.length===0)return null;const c=n.result.files[0].id,i=await fetch(`https://www.googleapis.com/drive/v3/files/${c}?alt=media`,{headers:{Authorization:`Bearer ${e.token}`}});if(!i.ok)return null;const t=await i.text(),s=t.match(/font:\s*([#\w]+)/i),a=t.match(/line:\s*([#\w]+)/i),l=t.match(/titleBg:\s*([#\w]+)/i),o=t.match(/titleText:\s*([#\w]+)/i),p=t.match(/logo:\s*([^\r\n]+)/i);if(s&&a&&l&&o){const m={font:s[1].trim(),line:a[1].trim(),titleBg:l[1].trim(),titleText:o[1].trim(),logo:p?p[1].trim():void 0};return e.albumColors[r]=m,m.logo&&await ie(r,m.logo),m}return null}catch(n){return console.error("Error loading album colors:",n),null}}async function ie(r,n){try{const c=await gapi.client.drive.files.list({q:`name = '${n}' and '${r}' in parents and trashed = false`,fields:"files(id)",pageSize:1});if(!c.result.files||c.result.files.length===0)return;const i=c.result.files[0].id,t=await fetch(`https://www.googleapis.com/drive/v3/files/${i}?alt=media`,{headers:{Authorization:`Bearer ${e.token}`}});if(!t.ok)return;const s=await t.blob(),a=URL.createObjectURL(s);e.albumLogos[r]=a}catch(c){console.error("Error loading album logo:",c)}}async function se(r,n,c){const i=`${n}-${c}-${r}`;if(e.syncedLyricsCache[i])return console.log("Synced lyrics found in cache"),{plain:null,synced:e.syncedLyricsCache[i]};if(e.lyricsCache[i])return console.log("Plain lyrics found in cache"),{plain:e.lyricsCache[i],synced:null};try{console.log(`Searching lrclib for: ${r} (Album: ${c})`);const t=`https://lrclib.net/api/search?track_name=${encodeURIComponent(r)}`,s=await fetch(t,{headers:{"User-Agent":"MP3P Music Player v1.0"}});if(!s.ok)return console.log("Search failed on lrclib"),{plain:null,synced:null};const a=await s.json();if(!a||a.length===0)return console.log("No results found"),{plain:null,synced:null};let l=a[0];for(const o of a)if(o.albumName&&c&&o.albumName.toLowerCase().includes(c.toLowerCase())){l=o,console.log(`Found album match: ${o.artistName} - ${o.trackName} (${o.albumName})`);break}if(l===a[0]){for(const o of a)if(o.artistName&&c&&o.artistName.toLowerCase().includes(c.toLowerCase())){l=o,console.log(`Found artist match: ${o.artistName} - ${o.trackName}`);break}}if(console.log(`Using: ${l.artistName} - ${l.trackName} (${l.albumName||"No album"})`),l.syncedLyrics){console.log("Synced lyrics found!");const o=ce(l.syncedLyrics);return e.syncedLyricsCache[i]=o,{plain:null,synced:o}}else if(l.plainLyrics)return console.log("Plain lyrics found"),e.lyricsCache[i]=l.plainLyrics,{plain:l.plainLyrics,synced:null};return{plain:null,synced:null}}catch(t){return console.error("Error fetching lyrics from lrclib:",t),{plain:null,synced:null}}}async function ae(r){if(!e.currentAlbum)return console.log("No current album"),{plain:null,synced:null};const{cleanName:n}=v(r),c=e.currentAlbum.name,i=e.currentAlbum.name;return await se(n,c,i)}function j(r){const n=document.querySelector(".lyrics-content");if(n)if(r.synced&&r.synced.length>0){e.currentLyrics=r.synced,e.currentLyricIndex=-1;const c=r.synced.map((i,t)=>{const s=i.text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return`<p class="lyric-line" data-index="${t}" data-time="${i.time}">${s}</p>`}).join("");n.innerHTML=c}else if(r.plain){e.currentLyrics=[],e.currentLyricIndex=-1;const i=r.plain.split(`
`).map(t=>{const s=t.trim();return s===""?"<p><br></p>":`<p>${s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}</p>`}).join("");n.innerHTML=i}else n.innerHTML='<p class="lyrics-placeholder">No lyrics available for this track</p>'}function K(r){const n=document.querySelector(".lyrics-curtain-content");if(n)if(r.synced&&r.synced.length>0){const c=r.synced.map((i,t)=>{const s=i.text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return`<p class="lyric-line-curtain" data-index="${t}" data-time="${i.time}">${s}</p>`}).join("");n.innerHTML=c}else if(r.plain){const i=r.plain.split(`
`).map(t=>{const s=t.trim();return s===""?"<p><br></p>":`<p>${s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}</p>`}).join("");n.innerHTML=i}else n.innerHTML='<p class="lyrics-placeholder">No lyrics available for this track</p>'}function oe(r){if(e.currentLyrics.length===0)return;let n=-1;for(let t=e.currentLyrics.length-1;t>=0;t--)if(r>=e.currentLyrics[t].time){n=t;break}if(n===e.currentLyricIndex)return;e.currentLyricIndex=n;const c=document.querySelector(".lyrics-content");c&&c.querySelectorAll(".lyric-line").forEach((s,a)=>{a===n?(s.classList.add("active"),s.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})):s.classList.remove("active")});const i=document.querySelector(".lyrics-curtain-content");i&&e.lyricsCurtainOpen&&i.querySelectorAll(".lyric-line-curtain").forEach((s,a)=>{a===n?(s.classList.add("active"),s.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})):s.classList.remove("active")})}function le(r){const n=e.albumColors[r];document.querySelectorAll(".album-title.playing").forEach(c=>{const i=c;n?(i.style.color=n.font,i.style.borderBottomColor=n.line):(i.style.color="",i.style.borderBottomColor="")})}function de(r){const n=e.albumColors[r],c=e.albumLogos[r];n?(u.style.backgroundColor=n.titleBg,u.style.color=n.titleText,c?(u.classList.add("has-logo"),u.style.backgroundImage=`url("${c}")`,u.setAttribute("aria-label",u.textContent||"")):(u.classList.remove("has-logo"),u.style.backgroundImage="")):(u.classList.remove("has-logo"),u.style.backgroundColor="",u.style.color="",u.style.backgroundImage="")}function ue(r){const n=e.albumColors[r];n?(h.style.backgroundColor=n.font,h.style.color=n.titleText):(h.style.backgroundColor="",h.style.color="")}function _(){u.classList.remove("has-logo"),u.style.backgroundColor="",u.style.color="",u.style.backgroundImage=""}function pe(){h.style.backgroundColor="",h.style.color=""}async function D(r,n){if(e.durationCache[r]){const c=document.querySelector(`[data-index="${n}"]`);c&&(c.textContent=e.durationCache[r]);return}try{const c=await fetch(`https://www.googleapis.com/drive/v3/files/${r}?alt=media`,{headers:{Authorization:`Bearer ${e.token}`,Range:"bytes=0-204800"}});if(!c.ok)return;const i=await c.blob(),t=URL.createObjectURL(i),s=new Audio(t);await new Promise((a,l)=>{const o=setTimeout(()=>{s.removeEventListener("loadedmetadata",p),s.removeEventListener("error",m),URL.revokeObjectURL(t),l(new Error("Timeout"))},5e3),p=()=>{clearTimeout(o);const g=s.duration;if(g&&isFinite(g)){const b=Math.floor(g/60),U=Math.floor(g%60),E=`${b}:${U.toString().padStart(2,"0")}`;e.durationCache[r]=E;const I=document.querySelector(`[data-index="${n}"]`);I&&(I.textContent=E)}URL.revokeObjectURL(t),a()},m=()=>{clearTimeout(o),URL.revokeObjectURL(t),l(new Error("Load error"))};s.addEventListener("loadedmetadata",p),s.addEventListener("error",m)})}catch(c){console.error(`Failed to load duration for file ${r}:`,c)}}function me(){const r=document.createElement("script");r.src="https://accounts.google.com/gsi/client",r.onload=ge,document.body.append(r);const n=document.createElement("script");n.src="https://apis.google.com/js/api.js",n.onload=()=>gapi.load("client",ye),document.body.append(n)}async function ye(){await gapi.client.init({apiKey:Y,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]}),e.token&&z()}function ge(){const r=google.accounts.oauth2.initTokenClient({client_id:Q,scope:V,callback:n=>{n.error||(e.token=n.access_token,sessionStorage.setItem("g_token",n.access_token),z())}});document.getElementById("auth-btn").onclick=()=>r.requestAccessToken({prompt:""}),S.onclick=()=>{w.style.display="none",e.searchQuery="",T.value="",_(),A()}}async function R(r,n){let c=[],i=null;do{const t=await gapi.client.drive.files.list({q:r,fields:`nextPageToken, files(${n})`,pageSize:1e3,pageToken:i});t.result.files&&(c=c.concat(t.result.files)),i=t.result.nextPageToken}while(i);return c}async function M(r,n){if(e.coverBlobCache[n]){r.src=e.coverBlobCache[n];return}try{const c=await fetch(`https://www.googleapis.com/drive/v3/files/${n}?alt=media`,{headers:{Authorization:`Bearer ${e.token}`}});if(!c.ok)throw new Error;const i=await c.blob(),t=URL.createObjectURL(i);e.coverBlobCache[n]=t,r.src=t}catch{r.src=k}}async function z(){if(e.token){gapi.client.setToken({access_token:e.token}),e.trackCache={},e.coverBlobCache={};try{y.innerHTML=`<div style="text-align:center; padding:50px; color:#666; font-weight:700;">SCANNING "${B}"...</div>`;const r=await gapi.client.drive.files.list({pageSize:1,fields:"files(id)",q:`name = '${B}' and mimeType = 'application/vnd.google-apps.folder' and trashed = false`});if(e.rootId=r.result.files?.[0]?.id,!e.rootId){y.innerHTML='<div style="text-align:center; padding:50px; color:var(--yellow); font-weight:700;">FOLDER NOT FOUND</div>';return}e.albums=await R(`'${e.rootId}' in parents and mimeType = 'application/vnd.google-apps.folder' and trashed = false`,"id, name");const n=await R("name = 'folder.jpg' and trashed = false","id, parents");e.covers={},n.forEach(c=>{c.parents?.[0]&&(e.covers[c.parents[0]]=c.id)}),A()}catch{y.innerHTML='<div style="text-align:center; padding:50px; color:var(--yellow);">CONNECTION FAILED<br>TRY RESET</div>'}}}function A(){if(S.style.display="none",q.classList.remove("album-mode"),u.innerText="MP3P",e.albums.length===0){y.innerHTML='<div style="text-align:center; padding:50px; color:#666;">NO ALBUMS FOUND</div>';return}const r=e.searchQuery?e.albums.filter(c=>c.name.toLowerCase().includes(e.searchQuery)):e.albums;if(r.length===0){y.innerHTML=`<div style="text-align:center; padding:50px; color:#666;">NO ALBUMS MATCH "${e.searchQuery}"</div>`;return}const n=document.createElement("div");n.className="grid",r.forEach(c=>{const i=e.covers[c.id],t=document.createElement("div");t.className="album-card";const s=c.id===e.playingAlbumId?"album-title playing":"album-title";t.innerHTML=`<img class="album-cover" src="${P}"><div class="${s}">${c.name}</div>`;const a=t.querySelector("img");i?M(a,i):a.src=k,t.onclick=()=>fe(c),n.appendChild(t)}),y.innerHTML="",y.appendChild(n),e.playingAlbumId&&le(e.playingAlbumId)}async function fe(r){if(e.currentAlbum=r,S.style.display="block",q.classList.add("album-mode"),u.innerText=r.name.toUpperCase(),w.style.display="none",await F(r.id)?de(r.id):_(),e.trackCache[r.id]){e.tracks=e.trackCache[r.id],O();return}y.innerHTML='<div style="text-align:center; padding:50px; color:#666; font-weight:700;">LOADING TRACKS...</div>';try{e.tracks=await R(`'${r.id}' in parents and (mimeType contains 'audio/') and trashed = false`,"id, name, mimeType, size"),e.tracks.sort((c,i)=>{const t=v(c.name),s=v(i.name);return t.number-s.number}),e.trackCache[r.id]=e.tracks,O()}catch{y.innerHTML="ERROR LOADING TRACKS"}}function O(){if(window.innerWidth>768){const n=document.createElement("div");n.className="album-view-desktop";const c=document.createElement("div");c.className="album-left";const i=document.createElement("div");i.className="album-art-large";const t=document.createElement("img");t.src=P;const s=e.currentAlbum&&e.covers[e.currentAlbum.id];s?M(t,s):t.src=k,i.appendChild(t);const a=document.createElement("div");a.className="album-info",a.innerHTML=`
      <h2>${e.currentAlbum?.name||"Unknown Album"}</h2>
      <p class="track-count">${e.tracks.length} tracks</p>
    `,c.appendChild(i),c.appendChild(a);const l=document.createElement("div");l.className="album-middle";const o=document.createElement("div");o.className="track-list-compact",e.tracks.forEach((m,g)=>{const b=document.createElement("div");b.className="track-row",m.id===e.playingFileId&&b.classList.add("active");const E=m.name.split(".").pop()?.toUpperCase()||"AUDIO",{cleanName:I}=v(m.name),G=e.durationCache[m.id]||"--:--";b.innerHTML=`
          <div class="track-left">
              <div class="track-num">${g+1}</div>
              <div class="track-info">
                  <div class="track-name">${I}</div>
              </div>
          </div>
          <div class="track-right">
              <span class="track-tech tech-ext">${E}</span>
              <span class="track-tech track-duration" data-index="${g}">${G}</span>
          </div>
      `,b.onclick=()=>f(g),o.appendChild(b),e.durationCache[m.id]||D(m.id,g)}),l.appendChild(o);const p=document.createElement("div");p.className="album-right",p.id="lyrics-panel",p.innerHTML=`
      <div class="lyrics-header">LYRICS</div>
      <div class="lyrics-content">
        <p class="lyrics-placeholder">Select a track to view lyrics</p>
      </div>
    `,(e.currentTrackLyrics.plain||e.currentTrackLyrics.synced)&&setTimeout(()=>j(e.currentTrackLyrics),100),n.appendChild(c),n.appendChild(l),n.appendChild(p),y.innerHTML="",y.appendChild(n)}else{const n=document.createElement("div");n.className="track-list",e.tracks.forEach((c,i)=>{const t=document.createElement("div");t.className="track-row",c.id===e.playingFileId&&t.classList.add("active");const a=c.name.split(".").pop()?.toUpperCase()||"AUDIO",{cleanName:l}=v(c.name),o=e.durationCache[c.id]||"--:--";t.innerHTML=`
          <div class="track-left">
              <div class="track-num">${i+1}</div>
              <div class="track-info">
                  <div class="track-name">${l}</div>
              </div>
          </div>
          <div class="track-right">
              <span class="track-tech tech-ext">${a}</span>
              <span class="track-tech track-duration" data-index="${i}">${o}</span>
          </div>
      `,t.onclick=()=>f(i),n.appendChild(t),e.durationCache[c.id]||D(c.id,i)}),y.innerHTML="",y.appendChild(n)}}async function f(r,n=0){if(e.isLoadingTrack){console.log("Already loading a track, skipping...");return}e.isLoadingTrack=!0,e.currentIndex=r,e.playlist=e.tracks;const c=e.playlist[r];e.playingFileId=c.id,e.currentAlbum&&(e.playingAlbumId=e.currentAlbum.id,await F(e.currentAlbum.id)?ue(e.currentAlbum.id):pe(),S.style.display==="none"&&A()),O(),x.innerText="LOADING...",C.innerText=e.currentAlbum?e.currentAlbum.name.toUpperCase():"UNKNOWN";const i=e.currentAlbum&&e.covers[e.currentAlbum.id];i?M(L,i):L.src=k,e.blobUrl&&(URL.revokeObjectURL(e.blobUrl),e.blobUrl=null);try{const t=await fetch(`https://www.googleapis.com/drive/v3/files/${c.id}?alt=media`,{headers:{Authorization:`Bearer ${e.token}`,Accept:"audio/*"}});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const s=await t.blob(),a=URL.createObjectURL(s);e.blobUrl=a,d.src=a,d.load(),await new Promise((o,p)=>{d.oncanplaythrough=o,d.onerror=p,setTimeout(p,1e4)}),await d.play(),e.isPlaying=!0,e.isLoadingTrack=!1,N();const{cleanName:l}=v(c.name);x.innerText=l.toUpperCase(),$.style.display="block",ae(c.name).then(o=>{e.currentTrackLyrics=o,document.querySelector(".lyrics-content")&&j(o),e.lyricsCurtainOpen&&K(o)}).catch(o=>{console.error("Failed to load lyrics:",o),e.currentTrackLyrics={plain:null,synced:null}})}catch(t){if(console.error("Playback Error:",t),e.isLoadingTrack=!1,n<2){console.log(`Retrying playback... (${n+1}/2)`),setTimeout(()=>f(r,n+1),1e3);return}x.innerText="ERROR PLAYING",t.message?.includes("403")||t.message?.includes("401")?C.innerText="TOKEN EXPIRED - RESET":t.name==="NotSupportedError"?C.innerText="FORMAT NOT SUPPORTED":C.innerText="PLAYBACK FAILED - TAP NEXT"}if("mediaSession"in navigator){const{cleanName:t}=v(c.name);navigator.mediaSession.metadata=new MediaMetadata({title:t,artist:e.currentAlbum?.name||"Unknown",artwork:[{src:L.src,sizes:"512x512",type:"image/jpeg"}]}),navigator.mediaSession.setActionHandler("play",()=>{d.play(),e.isPlaying=!0,N()}),navigator.mediaSession.setActionHandler("pause",()=>{d.pause(),e.isPlaying=!1,N()}),navigator.mediaSession.setActionHandler("previoustrack",()=>{e.currentIndex>0&&f(e.currentIndex-1)}),navigator.mediaSession.setActionHandler("nexttrack",()=>{e.currentIndex<e.playlist.length-1&&f(e.currentIndex+1)})}}function N(){h.textContent=e.isPlaying?"||":"▶"}h.onclick=()=>{d.paused?(d.play(),e.isPlaying=!0):(d.pause(),e.isPlaying=!1),N()};X.onclick=()=>{e.currentIndex<e.playlist.length-1&&f(e.currentIndex+1)};J.onclick=()=>{e.currentIndex>0&&f(e.currentIndex-1)};d.ontimeupdate=()=>{if(!d.duration)return;const r=d.currentTime/d.duration*100;te.style.width=`${r}%`,oe(d.currentTime)};d.onended=()=>{e.currentIndex<e.playlist.length-1&&f(e.currentIndex+1)};d.onerror=r=>{console.error("Audio element error:",r),e.isLoadingTrack=!1,e.isPlaying&&(x.innerText="PLAYBACK ERROR",C.innerText="SKIPPING...",setTimeout(()=>{e.currentIndex<e.playlist.length-1&&f(e.currentIndex+1)},1500))};Z.onclick=r=>{const n=ee.getBoundingClientRect(),c=(r.clientX-n.left)/n.width;d.currentTime=c*d.duration};me();
